---
title: "get matches"
output: html_document
---

```{r, conditional-eval}

filename <- "in/matches_buli.rds"

eval_cond <- !file.exists(filename)

```


```{r setup, include=FALSE, eval=eval_cond}
knitr::opts_chunk$set(echo = TRUE)
library(worldfootballR)
library(magrittr)
library(lubridate)
library(furrr)
library(future)
library(tidyverse)

```

```{r, setup-parallel, eval=eval_cond}

par_cores <- availableCores() - 1
plan("multisession", workers = par_cores, gc = TRUE)

```

```{r, get-matches, eval=eval_cond}

years <- 2000:(year(Sys.Date()) - 1)

buli_matches <- future_map(years,
                         ~ get_match_results(country = "GER", gender = "M", season_end_year = .x, tier = "1st") %>% 
                           select(-Competition_Name, -MatchURL))

buli_matches %<>% bind_rows()

```


```{r, save-matches-buli, eval=eval_cond}

saveRDS(object = buli_matches, file = filename)

```